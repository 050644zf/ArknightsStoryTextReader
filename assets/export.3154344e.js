import{_ as u,r as f,o as m,c as g,l as _,a as t,F as x,b,t as p,w as v,f as w,m as y}from"./jquery.35eba1a5.js";import{f as L,h as k}from"./func.55e3f36b.js";import{x as c}from"./xlsx.e7838f39.js";import{i as S}from"./i18n.cce29cd3.js";const A={data(){return{exportList:[],filename:"export",exportFile:null,logs:"",i18n:S,lang:L.l}},created(){this.exportList=window.localStorage.getItem("exportList")?JSON.parse(window.localStorage.getItem("exportList")):[],this.filename=window.localStorage.getItem("filename")?window.localStorage.getItem("filename"):"export"},methods:{removeAll(){this.exportList=[],window.localStorage.setItem("exportList",JSON.stringify(this.exportList)),this.filename="export",window.localStorage.setItem("filename",this.filename)},async exportAll(){this.logs="Export Process Start...<br/>",this.logs+="Export List Length: "+this.exportList.length+"<br/>",this.exportFile=c.utils.book_new(),this.exportFile.Props={Title:"Exported Data",Subject:"Exported from Arknights Story Text Reader. https://050644zf.github.io/ArknightsStoryTextReader/"},this.logs+="Workbook Created.<br/>",await new Promise(o=>{this.exportStories().then(o)}).then(()=>{c.writeFile(this.exportFile,this.filename+".xlsx",{type:"file"}),this.logs+="Export Process Finished.<br/>"})},async exportStories(){for(const o of this.exportList)await this.exportStory(o)},async exportStory(o){this.logs+="Exporting Story: "+o.storyCode+" "+o.avgTag+" "+o.storyName+"<br/>";let e=await fetch("https://raw.githubusercontent.com/050644zf/ArknightsStoryJson/main/"+o.server+"/gamedata/story/"+o.path+".json");e=await e.json();let l=this.reader(e),n=c.utils.aoa_to_sheet(l);return n["!cols"]=[],n["!cols"][0]={hidden:!0,wch:15},n["!cols"][1]={wch:25},n["!cols"][2]={wch:70},await new Promise((s,r)=>{c.utils.book_append_sheet(this.exportFile,n,this.getsheetname(o.path)),s()})},getsheetname(o){const e=o.split("/").length;return o.split("/")[e-1]},reader(o){var e=[];for(var l in o.storyList){var n=o.storyList[l],s=n.id,r=n.prop,a=n.attributes;if(r=="Comment"&&e.push([s,"--Comment--",a.value]),r=="name"&&e.push([s,a.name,a.content]),r=="Dialog"&&e.push([s,"----","----"]),r=="Decision"){e.push([s,"--Decision--","----"]);var i=a.options.split(";"),h=a.values.split(";");for(let d=0;d<Math.min(i.length,h.length);d++)e.push([s,"Option_"+h[d],i[d]]);e.push([s,"--Decision End--","----"])}r=="Predicate"&&(n.endOfOpt?e.push([s,"--Branch--","End of Options"]):e.push([s,"--Branch--",">Options_"+a.references.replaceAll(";","&")])),r=="Subtitle"&&(e.push([""]),e.push([s,"",a.text]),e.push([""])),Object.keys(a).indexOf("image")!=-1&&(r=r.toLowerCase(),e.push([s,"--"+r+"--","https://raw.githubusercontent.com/Aceship/Arknight-Images/main/avg/"+r+"s/"+a.image+".png"]))}return e},async book_append_sheet(o,e,l){return c.utils.book_append_sheet(o,e,l),await Promise.resolve("done")},home(){history.back()}},components:{Header:k}},C={class:"exportpage"},E=t("span",{class:"material-icons"}," menu_open ",-1),F=t("span",{class:"home nt"},"\u8FD4\u56DE\u4E0A\u4E00\u9875/Return to Last Page",-1),I=[E,F],O=t("div",{class:"nt"},"\u5F53\u524D\u5BFC\u51FA\u5217\u8868/Current Exporting List: ",-1),P={class:"exportList st"},D={class:"filename lt"},T=t("span",null,"\u5BFC\u51FA\u6587\u4EF6\u540D / Export File Name: ",-1),B=t("span",null,".xlsx",-1),N=t("span",{class:"material-icons"}," clear_all ",-1),j=t("span",null,"\u6E05\u7A7A/Clear",-1),H=[N,j],M=t("span",{class:"material-icons"}," file_download ",-1),V=t("span",null,"\u5BFC\u51FA\u6240\u6709/Export All",-1),z=[M,V],R=["innerHTML"];function J(o,e,l,n,s,r){const a=f("Header");return m(),g(x,null,[_(a),t("div",C,[t("button",{class:"homepage lt",onClick:e[0]||(e[0]=i=>r.home())},I),O,t("div",P,[t("table",null,[(m(!0),g(x,null,b(s.exportList,(i,h)=>(m(),g("tr",{key:h,class:"exportItem"},[t("td",null,p(i.server),1),t("td",null,p(i.storyCode)+" "+p(i.avgTag),1),t("td",null,p(i.storyName),1),t("td",null,p(i.path),1)]))),128))])]),t("div",D,[T,v(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=i=>s.filename=i),placeholder:"\u8BF7\u8F93\u5165\u6587\u4EF6\u540D/Please input file name"},null,512),[[w,s.filename]]),B]),t("div",null,[t("button",{class:"removeAll nt",onClick:e[2]||(e[2]=i=>r.removeAll())},H),t("button",{class:"exportBtn nt",onClick:e[3]||(e[3]=i=>r.exportAll())},z)]),t("div",{class:"logArea xst",innerHTML:s.logs},null,8,R)])],64)}var U=u(A,[["render",J]]);y(U).mount("#export");
