import{_ as g}from"./plugin-vue_export-helper.ad25fb64.js";import{f as x,h as f}from"./func.62a4b45a.js";import{x as p,r as v,c as m,l as w,a as t,F as _,b,t as h,w as y,f as L,o as d,m as S}from"./vendor.61975e9a.js";import{i as k}from"./i18n.6d0aeb99.js";const A={data(){return{exportList:[],filename:"export",exportFile:null,logs:"",i18n:k,lang:x.l}},created(){this.exportList=window.localStorage.getItem("exportList")?JSON.parse(window.localStorage.getItem("exportList")):[],this.filename=window.localStorage.getItem("filename")?window.localStorage.getItem("filename"):"export"},methods:{removeAll(){this.exportList=[],window.localStorage.setItem("exportList",JSON.stringify(this.exportList)),this.filename="export",window.localStorage.setItem("filename",this.filename)},async exportAll(){this.logs="Export Process Start...<br/>",this.logs+="Export List Length: "+this.exportList.length+"<br/>",this.exportFile=p.utils.book_new(),this.exportFile.Props={Title:"Exported Data",Subject:"Exported from Arknights Story Text Reader. https://050644zf.github.io/ArknightsStoryTextReader/"},this.logs+="Workbook Created.<br/>",await new Promise(s=>{this.exportStories().then(s)}).then(()=>{p.writeFile(this.exportFile,this.filename+".xlsx",{type:"file"}),this.logs+="Export Process Finished.<br/>"})},async exportStories(){for(const s of this.exportList)await this.exportStory(s)},async exportStory(s){this.logs+="Exporting Story: "+s.storyCode+" "+s.avgTag+" "+s.storyName+"<br/>";let e=await fetch("https://raw.githubusercontent.com/050644zf/ArknightsStoryJson/main/"+s.server+"/gamedata/story/"+s.path+".json");e=await e.json();let l=this.reader(e),r=p.utils.aoa_to_sheet(l);return r["!cols"]=[],r["!cols"][0]={hidden:!0,wch:15},r["!cols"][1]={wch:25},r["!cols"][2]={wch:70},await new Promise((o,i)=>{p.utils.book_append_sheet(this.exportFile,r,this.getsheetname(s.path)),o()})},getsheetname(s){const e=s.split("/").length;return s.split("/")[e-1]},reader(s){var e=[];for(var l in s.storyList){var r=s.storyList[l],o=r.id,i=r.prop,a=r.attributes;if(i=="Comment"&&e.push([o,"--Comment--",a.value]),i=="name"&&e.push([o,a.name,a.content]),i=="Dialog"&&e.push([o,"----","----"]),i=="Decision"){e.push([o,"--Decision--","----"]);var n=a.options.split(";"),c=a.values.split(";");for(let u=0;u<Math.min(n.length,c.length);u++)e.push([o,"Option_"+c[u],n[u]]);e.push([o,"--Decision End--","----"])}i=="Predicate"&&(r.endOfOpt?e.push([o,"--Branch--","End of Options"]):e.push([o,"--Branch--",">Options_"+a.references.replaceAll(";","&")])),i=="Subtitle"&&(e.push([""]),e.push([o,"",a.text]),e.push([""])),Object.keys(a).indexOf("image")!=-1&&(i=i.toLowerCase(),e.push([o,"--"+i+"--","https://aceship.github.io/AN-EN-Tags/img/avg/"+i+"s/"+a.image+".png"]))}return e},async book_append_sheet(s,e,l){return p.utils.book_append_sheet(s,e,l),await Promise.resolve("done")},home(){history.back()}},components:{Header:f}},E={class:"exportpage"},C=t("span",{class:"material-icons"}," menu_open ",-1),F=t("span",{class:"home nt"},"\u8FD4\u56DE\u4E0A\u4E00\u9875/Return to Last Page",-1),j=[C,F],N=t("div",{class:"nt"},"\u5F53\u524D\u5BFC\u51FA\u5217\u8868/Current Exporting List: ",-1),O={class:"exportList st"},P={class:"filename lt"},T=t("span",null,"\u5BFC\u51FA\u6587\u4EF6\u540D / Export File Name: ",-1),D=t("span",null,".xlsx",-1),I=t("span",{class:"material-icons"}," clear_all ",-1),B=t("span",null,"\u6E05\u7A7A/Clear",-1),H=[I,B],M=t("span",{class:"material-icons"}," file_download ",-1),V=t("span",null,"\u5BFC\u51FA\u6240\u6709/Export All",-1),R=[M,V],z=["innerHTML"];function J(s,e,l,r,o,i){const a=v("Header");return d(),m(_,null,[w(a),t("div",E,[t("button",{class:"homepage lt",onClick:e[0]||(e[0]=n=>i.home())},j),N,t("div",O,[t("table",null,[(d(!0),m(_,null,b(o.exportList,(n,c)=>(d(),m("tr",{key:c,class:"exportItem"},[t("td",null,h(n.server),1),t("td",null,h(n.storyCode)+" "+h(n.avgTag),1),t("td",null,h(n.storyName),1),t("td",null,h(n.path),1)]))),128))])]),t("div",P,[T,y(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=n=>o.filename=n),placeholder:"\u8BF7\u8F93\u5165\u6587\u4EF6\u540D/Please input file name"},null,512),[[L,o.filename]]),D]),t("div",null,[t("button",{class:"removeAll nt",onClick:e[2]||(e[2]=n=>i.removeAll())},H),t("button",{class:"exportBtn nt",onClick:e[3]||(e[3]=n=>i.exportAll())},R)]),t("div",{class:"logArea xst",innerHTML:o.logs},null,8,z)])],64)}var U=g(A,[["render",J]]);S(U).mount("#export");
